<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mermaid Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            padding: 40px;
            background: #f5f5f7;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 12px;
        }
    </style>
</head>

<body>
    <h1>Mermaid Rounded Corners Debug</h1>

    <div class="mermaid">
        flowchart TD
        subgraph CLI
        A[main.ts] --> B[print/]
        A --> C[snap/]
        end

        subgraph Print Domain
        B --> D[renderer.ts]
        B --> E[templates/]
        end

        D --> I[Playwright]
        I --> J[Chromium]
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: false,
            theme: 'base',
            themeVariables: {
                primaryColor: '#e8f4fd',
                primaryTextColor: '#1d1d1f',
                primaryBorderColor: '#007AFF',
                lineColor: '#86868b',
                mainBkg: '#e8f4fd',
                nodeBorder: '#007AFF',
                clusterBkg: 'rgba(0, 122, 255, 0.05)',
                clusterBorder: 'rgba(0, 122, 255, 0.2)',
                fontFamily: '"SF Mono", "Fira Code", Menlo, monospace',
                fontSize: '13px',
            },
            flowchart: {
                curve: 'basis',
                nodeSpacing: 50,
                rankSpacing: 60,
            },
        });

        async function init() {
            await mermaid.run();

            // Post-process: Add rounded corners
            console.log('Found rects:', document.querySelectorAll('.node rect').length);
            document.querySelectorAll('.node rect').forEach((rect) => {
                console.log('Before:', rect.getAttribute('rx'), rect.getAttribute('ry'));
                rect.setAttribute('rx', '12');
                rect.setAttribute('ry', '12');
                console.log('After:', rect.getAttribute('rx'), rect.getAttribute('ry'));
            });

            document.querySelectorAll('.cluster rect').forEach((rect) => {
                rect.setAttribute('rx', '16');
                rect.setAttribute('ry', '16');
            });

            console.log('Rounded corners applied!');
        }

        init();
    </script>
</body>

</html>